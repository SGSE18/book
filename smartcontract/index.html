<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SGSE 18 | Smart Contracts</title>
    <meta name="description" content="Kursmaterial für das Fach &quot;Spezielle Gebiete zum Software Engineering&quot;">
    <link rel="icon" href="/book/logo.png">
    
    <link rel="preload" href="/book/assets/css/32.styles.bfc63ef0.css" as="style"><link rel="preload" href="/book/assets/js/app.1347648d.js" as="script"><link rel="preload" href="/book/assets/js/3.c76dc4bd.js" as="script"><link rel="prefetch" href="/book/assets/js/0.ffac3b5e.js"><link rel="prefetch" href="/book/assets/js/1.27ab599d.js"><link rel="prefetch" href="/book/assets/js/2.d921bfba.js"><link rel="prefetch" href="/book/assets/js/4.edbf4648.js"><link rel="prefetch" href="/book/assets/js/5.9ccd745b.js"><link rel="prefetch" href="/book/assets/js/6.a7567d1d.js"><link rel="prefetch" href="/book/assets/js/7.8f411df4.js"><link rel="prefetch" href="/book/assets/js/8.62ed7507.js"><link rel="prefetch" href="/book/assets/js/9.c17f15e7.js"><link rel="prefetch" href="/book/assets/js/10.b8e89859.js"><link rel="prefetch" href="/book/assets/js/11.9d9d13a7.js"><link rel="prefetch" href="/book/assets/js/12.7beecde8.js"><link rel="prefetch" href="/book/assets/js/13.bea437fa.js"><link rel="prefetch" href="/book/assets/js/14.ba1a754d.js"><link rel="prefetch" href="/book/assets/js/15.842dcb0f.js"><link rel="prefetch" href="/book/assets/js/16.26086763.js"><link rel="prefetch" href="/book/assets/js/17.a2265125.js"><link rel="prefetch" href="/book/assets/js/18.b4756d92.js"><link rel="prefetch" href="/book/assets/js/19.128bdf03.js"><link rel="prefetch" href="/book/assets/js/20.928b207d.js"><link rel="prefetch" href="/book/assets/js/21.5e71017b.js"><link rel="prefetch" href="/book/assets/js/22.8f14da83.js"><link rel="prefetch" href="/book/assets/js/23.8b420a0a.js"><link rel="prefetch" href="/book/assets/js/24.0e1b2310.js"><link rel="prefetch" href="/book/assets/js/25.32fa1e3b.js"><link rel="prefetch" href="/book/assets/js/26.ffcb15b9.js"><link rel="prefetch" href="/book/assets/js/27.fa64e301.js"><link rel="prefetch" href="/book/assets/js/28.3714341f.js"><link rel="prefetch" href="/book/assets/js/29.c62477cb.js"><link rel="prefetch" href="/book/assets/js/30.dd93c7ce.js"><link rel="prefetch" href="/book/assets/js/31.442a0f4a.js">
    <link rel="stylesheet" href="/book/assets/css/32.styles.bfc63ef0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/book/" class="home-link router-link-active"><!----><span class="site-name">
      SGSE 18
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/book/kurs/" class="nav-link">Kursmaterial</a></div><a href="https://github.com/SGSE18/book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/book/kurs/" class="nav-link">Kursmaterial</a></div><a href="https://github.com/SGSE18/book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Grundlagen</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/book/digitalisierung/" class="sidebar-link">Digitalisierung</a></li><li><a href="/book/cloud/" class="sidebar-link">Cloud computing</a></li><li><a href="/book/dezentralisierung/" class="sidebar-link">Dezentralisierung</a></li><li><a href="/book/smartcontract/" class="active sidebar-link">Smart Contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/book/smartcontract/#vulnerabilities" class="sidebar-link">Vulnerabilities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/book/smartcontract/#typische-schwachstellen" class="sidebar-link">Typische Schwachstellen</a></li><li class="sidebar-sub-header"><a href="/book/smartcontract/#honey-pots" class="sidebar-link">Honey Pots</a></li><li class="sidebar-sub-header"><a href="/book/smartcontract/#empfehlungen" class="sidebar-link">Empfehlungen</a></li></ul></li><li class="sidebar-sub-header"><a href="/book/smartcontract/#oracle-data-service-marketplace" class="sidebar-link">Oracle Data Service Marketplace</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/book/smartcontract/#existierende-losungen" class="sidebar-link">Existierende Lösungen</a></li><li class="sidebar-sub-header"><a href="/book/smartcontract/#vorgeschlagene-losung" class="sidebar-link">Vorgeschlagene Lösung</a></li></ul></li><li class="sidebar-sub-header"><a href="/book/smartcontract/#referenzen" class="sidebar-link">Referenzen</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Continuous Software Engineering</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Architekturen</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fullstack Development</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>AI - machine learning</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Embedded</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Blockchain</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="smart-contracts"><a href="#smart-contracts" aria-hidden="true" class="header-anchor">#</a> Smart Contracts</h1><p>Autor: Cem Basoglu</p><p>Mit der Erweiterung der Blockchain und Distributed Ledger Technologien um <a href="/book/blockchain/usecases/#smart-contracts">Smart
Contracts</a>, ergeben sich vielseitige
Möglichkeiten für neue und bestehende Anwendungsbereiche
[<a href="#ref_reyn18">REYN18</a>, <a href="#ref_kim18">KIM18</a>, <a href="#ref_stru18">STRU18</a>]. Wie mit
jeder neuen Technologie, aus denen sich neue Möglichkeiten ergeben, gehen diese
auch bei Smart Contracts mit neuen Risiken einher. Neben rechtlicher und
finanzieller Risiken, nehmen Fehler im Design bzw. der Implementierung von
Smart Contracts, einen weitaus größeren Stellenwert ein. Im Gegensatz zu
klassischen Applikationen, lassen sich einmal veröffentlichte Smart Contracts
nicht mehr updaten und auch durch die Fehler verursachte Änderungen am
Distributed Ledger nicht mehr rückgängig machen. In diesem Zusammenhang wirkt
die positive <a href="/book/smartcontract/blockchain/technologie/#eigenschaften-einer-blockchain">Eigenschaft</a>
von Distributed Leders, der Unveränderlichkeit von Transaktionsblöcken,
kontraproduktiv auf die Entwicklung von Smart Contracts.</p><h2 id="vulnerabilities"><a href="#vulnerabilities" aria-hidden="true" class="header-anchor">#</a> Vulnerabilities</h2><p>Da Smart Contracts in der Regel ebenfalls Vermögenswerte verwalten, ist es
essenziell mögliche Schwachstellen bereits im voraus zu erkennen. Dabei liegen
die meisten Schwachstellen nicht direkt in dem implementierten Codeblock,
sondern ergeben sich erst durch die unberücksichtigte Wechselwirkung, mit der
zugrunde liegenden Smart Contract Plattform.</p><h3 id="typische-schwachstellen"><a href="#typische-schwachstellen" aria-hidden="true" class="header-anchor">#</a> Typische Schwachstellen</h3><p>Da Smart Contracts erst in den vergangen Jahren an Bedeutung gewonnen haben,
entstehen derartige Schwachstellen durch den Mangel an Erfahrungen, um diese
zu erkennen und zu vermeiden. In diesem Abschnitt werden daher zunächst die
häufigsten Fallstricke betrachtet und anschließend mögliche Vorgehensweisen
präsentiert.</p><h4 id="call-depth-attack"><a href="#call-depth-attack" aria-hidden="true" class="header-anchor">#</a> Call Depth Attack</h4><p>Die Ethereum Virtual Machine (EVM) begrenzt die Call Stack Tiefe einer
Transaktion auf 1024 Aufrufe. Somit kann ein Angreifer die Call Stack Tiefe
einer Transaktion, mittels rekrusiven Aufrufen, künstlich vor die Limitierung
positionieren, um anschliessend Fehler in der darauf folgenden zu Verarbeitung
der Transaktion zu provozieren.</p><pre class="language-javascript"><code>contract auction <span class="token punctuation">{</span>
  <span class="token function">mapping</span><span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> uint<span class="token punctuation">)</span> refunds<span class="token punctuation">;</span>
  <span class="token comment">// [...]</span>
  <span class="token keyword">function</span> <span class="token function">withdrawRefund</span><span class="token punctuation">(</span>address recipient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint refund <span class="token operator">=</span> refunds<span class="token punctuation">[</span>recipient<span class="token punctuation">]</span><span class="token punctuation">;</span>
    refunds<span class="token punctuation">[</span>recipient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    recipient<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>refund<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Obwohl die Funktion in sich keine Fehler aufweist und auch dem Empfänger
vertraut werden kann, schlägt der Aufruf <code>recipient.send(refund)</code> fehl,
da <code>send(...)</code> ebenfalls die Call Stack Tiefe erhöht. Da jedoch alle zuvor
ausgeführten Änderungen erfolgreich waren, wird das Konto des Empfängers auf 0
gesetzt ohne den Betrag tatsächlich transferiert zu haben.</p><p>Um eine derartige Schwachstelle zu vermeiden, ist Empfehlenswert den
Rückgabewert der <code>send(...)</code>-Funktion auszuwerten und die Ausführung wie folgt
mit <code>throw</code> zu terminieren.</p><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>recipient<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>refund<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><p>Durch die Terminierung mit <code>throw</code>, werden durch die Transaktion, keine State-
Änderungen in den Distributed Ledger übernommen. Damit bleibt das Guthaben
des Empfängers auch dann erhalten, wenn der darauf folgende Transfer
fehlschlägt. Durch diesen Angriff kann sich der Angreifer zwar keinen
finanziellen Vorteil verschaffen, aber einen Schaden bei den Guthabenbesitzern
verursachen.</p><h4 id="re-entrency-und-cross-function-race-conditions"><a href="#re-entrency-und-cross-function-race-conditions" aria-hidden="true" class="header-anchor">#</a> Re-Entrency und Cross-function Race Conditions</h4><p>Auf den ersten Blick erfüllen beiden Funktionen im folgenden Smart Contract die
an die jeweilige Funktion gestellten Anforderungen. Der Benutzer darf mit der
Funktion <code>transfer(...)</code> einen Betrag, der sein eigenes Guthaben nicht
übersteigt, einer beliebige anderen Adresse zuordnen und mit der Funktion
<code>withdrawBalance()</code> das gesamte eigene Guthaben, an die hinterlegte Adresse
überweisen.</p><pre class="language-javascript"><code>contract auction <span class="token punctuation">{</span>
  <span class="token function">mapping</span> <span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> uint<span class="token punctuation">)</span> <span class="token keyword">private</span> userBalances<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span>address to<span class="token punctuation">,</span> uint amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>userBalances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         userBalances<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span>
         userBalances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">withdrawBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
      uint amountToWithdraw <span class="token operator">=</span> userBalances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
      msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>amountToWithdraw<span class="token punctuation">)</span><span class="token punctuation">;</span>
      userBalances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Mit der sogenannten Re-Entrency Attacke, kann sich ein Angreifer das gesamte
Guthaben in dem Smart Contract (Guthaben aller Benutzer) auszahlen lassen,
in dem er einen eigenen Smart Contract mit der Default-Funktion implementiert.
Die Default-Funktion in einem Smart Contract wird aufgerufen, sobald eine
Transaktion an die Smart Contract Adresse eingeht. Die Default-Funktion ruft
wiederum erneut die <code>withdrawBalance()</code>-Funktion auf. Da in der
<code>withdrawBalance()</code>-Funktion das Guthaben des Angreifers an die böswillige
Smart Contract Adresse überwiesen wird, ergibt sich somit eine rekursive
Schleife zwischen den beiden Smart Contracts. Damit wird die Zeile
<code>userBalances[msg.sender] = 0</code> erst erreicht, wenn das gesamte Guthaben im
Smart Contract aufgebraucht ist, wodurch die <code>send(...)</code>-Funktion fehlschlägt.</p><p>Statt dem erneuten Aufruf der <code>withdrawBalance()</code>-Funktion, kann der Angreifer
auch eine Cross-function Race Condition provozieren. Dazu wird erneut ein
böswilliger Smart Contract implementiert und stattdessen diesmal die
<code>transfer(...)</code>-Funktion in der Default-Funktion aufgerufen. Somit wird das
Guthaben einer anderen Adresse zugeordnet, bevor das seiner Adresse zugeordnete
Guthaben auf 0 gesetzt wird.</p><p>Beide Schwachstellen lassen sich beheben, in dem das Guthaben der aufrufenden
Adresse vor der Ausführung der Überweisung auf 0 gesetzt wird. Um im Fehlerfall
das Guthaben wiederherzustellen, empfiehlt es sich zusätzlich den Rückgabewert
der <code>send()</code>-Funktion zu prüfen, die Ausführung mit <code>throw</code> zu terminieren und
damit alle durch die Transaktion entstanden Änderungen am State, Rückgängig zu
machen.</p><h4 id="dos-with-unexpected-throws"><a href="#dos-with-unexpected-throws" aria-hidden="true" class="header-anchor">#</a> DoS with unexpected throws</h4><p>Im folgenden Smart Contract sollen die Teilnehmer einer Auktion, mit dem Aufruf
der <code>bid()</code>-Funktion an der Auktion teilnehmen können. Dazu muss der Teilnehmer
einen Betrag größer als das aktuelle Höchstgebot überweisen. Wird das aktuelle
Höchstgebot überboten, erhält der alte Höchstbietende seinen zuvor überwiesenen
Betrag zurück. Bei der Implementierung werden alle zuvor genannten
Vorgehensweisen, wie die Prüfung des Rückgabewerts der <code>send(...)</code>-Funktion
und die Terminierung mit <code>throw</code> im Fehlerfall, entsprechend in der
<code>bid()</code>-Funktion implementiert.</p><pre class="language-javascript"><code>contract auction <span class="token punctuation">{</span>
  address currentLeader<span class="token punctuation">;</span>
  uint highestBid<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">bid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&lt;=</span> highestBid<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentLeader<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>highestBid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

      currentLeader <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
      highestBid <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>In diesem Fall kann ein Angreifer jedoch die Abgabe weitere Gebote blockieren,
in dem er einen Smart Contract mit einer Default-Funktion implementiert, die
immer zu einem Fehler, z.B durch die Überschreitung der Call Stack Tiefe, führt.
Wird nun ein neues Höchstgebot abgegeben, erhält der aktuelle Höchstbieter
(Angreifer) sein Gebot wieder, wodurch die Default-Funktion im Smart Contract
des Angreifers aufgerufen wird. Da diese jedoch fehlschlägt, liefert <code>send(...)</code>
einen Fehler zurück wodurch die Ausführung terminiert und alle Änderungen
rückgängig gemacht werden. Somit ist der Angreifer weiterhin der Höchstbietende
und neue Höchstgebote schlagen immer fehl.</p><p>Eine mögliche Lösung besteht darin, in diesem Fall keine Terminierung durch den
<code>throw</code> im Fehlerfall vorzunehmen. Alternativ kann aber auch eine Liste der
alten Höchstbietenden und deren Gebote geführt und ganz auf die automatische
Auszahlung verzichtet werden. Über eine zusätzliche Funktion können sich
anschließend die in dieser Liste geführten Höchstbieter ihr Gebot erstatten
lassen.</p><h3 id="honey-pots"><a href="#honey-pots" aria-hidden="true" class="header-anchor">#</a> Honey Pots</h3><h4 id="multiplicatorx3"><a href="#multiplicatorx3" aria-hidden="true" class="header-anchor">#</a> MultiplicatorX3</h4><p>https://etherscan.io/address/0x5aa88d2901c68fda244f1d0584400368d2c8e739#code</p><pre class="language-javascript"><code>pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.18</span><span class="token punctuation">;</span>

contract MultiplicatorX3
<span class="token punctuation">{</span>
    address <span class="token keyword">public</span> Owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>

    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable<span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> payable <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> Owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Owner<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">Command</span><span class="token punctuation">(</span>address adr<span class="token punctuation">,</span>bytes data<span class="token punctuation">)</span> payable <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> Owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        adr<span class="token punctuation">.</span>call<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">multiplicate</span><span class="token punctuation">(</span>address adr<span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span>
            adr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">+</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="transferlog"><a href="#transferlog" aria-hidden="true" class="header-anchor">#</a> TransferLog</h4><p>https://etherscan.io/address/0xb5e1b1ee15c6fa0e48fce100125569d430f1bd12#code</p><pre class="language-javascript"><code>pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.19</span><span class="token punctuation">;</span>
contract Private_Bank <span class="token punctuation">{</span>
    <span class="token function">mapping</span> <span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> uint<span class="token punctuation">)</span> <span class="token keyword">public</span> balances<span class="token punctuation">;</span>
    uint <span class="token keyword">public</span> MinDeposit <span class="token operator">=</span> <span class="token number">1</span> ether<span class="token punctuation">;</span>
    Log TransferLog<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">Private_Bank</span><span class="token punctuation">(</span>address _log<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        TransferLog <span class="token operator">=</span> <span class="token function">Log</span><span class="token punctuation">(</span>_log<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">Deposit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> MinDeposit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token operator">+=</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            TransferLog<span class="token punctuation">.</span><span class="token function">AddMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">,</span><span class="token string">&quot;Deposit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">CashOut</span><span class="token punctuation">(</span>uint _am<span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_am<span class="token operator">&lt;=</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>call<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>_am<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token operator">-=</span>_am<span class="token punctuation">;</span>
                TransferLog<span class="token punctuation">.</span><span class="token function">AddMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>_am<span class="token punctuation">,</span><span class="token string">&quot;CashOut&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable<span class="token punctuation">{</span><span class="token punctuation">}</span>    

<span class="token punctuation">}</span>
contract Log <span class="token punctuation">{</span>
    struct Message <span class="token punctuation">{</span>
        address Sender<span class="token punctuation">;</span>
        string  Data<span class="token punctuation">;</span>
        uint Val<span class="token punctuation">;</span>
        uint  Time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Message<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> History<span class="token punctuation">;</span>
    Message LastMsg<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">AddMessage</span><span class="token punctuation">(</span>address _adr<span class="token punctuation">,</span>uint _val<span class="token punctuation">,</span>string _data<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        LastMsg<span class="token punctuation">.</span>Sender <span class="token operator">=</span> _adr<span class="token punctuation">;</span>
        LastMsg<span class="token punctuation">.</span>Time <span class="token operator">=</span> now<span class="token punctuation">;</span>
        LastMsg<span class="token punctuation">.</span>Val <span class="token operator">=</span> _val<span class="token punctuation">;</span>
        LastMsg<span class="token punctuation">.</span>Data <span class="token operator">=</span> _data<span class="token punctuation">;</span>
        History<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>LastMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="empfehlungen"><a href="#empfehlungen" aria-hidden="true" class="header-anchor">#</a> Empfehlungen</h3><h4 id="checks-effects-interactions-pattern"><a href="#checks-effects-interactions-pattern" aria-hidden="true" class="header-anchor">#</a> Checks-Effects-Interactions Pattern</h4><h4 id="formal-verification-methods"><a href="#formal-verification-methods" aria-hidden="true" class="header-anchor">#</a> Formal verification methods</h4><p>https://arxiv.org/pdf/1802.06038.pdf</p><p>https://media.consensys.net/how-formal-verification-can-ensure-flawless-smart-contracts-cbda8ad99bd1</p><p>http://antoine.delignat-lavaud.fr/doc/plas16.pdf</p><p>https://github.com/pirapira/ethereum-formal-verification-overview</p><h2 id="oracle-data-service-marketplace"><a href="#oracle-data-service-marketplace" aria-hidden="true" class="header-anchor">#</a> Oracle Data Service Marketplace</h2><p>einleiten mit grundlegendem zu oracles und das ziel des marketplaces</p><h3 id="existierende-losungen"><a href="#existierende-losungen" aria-hidden="true" class="header-anchor">#</a> Existierende Lösungen</h3><h4 id="oraclize"><a href="#oraclize" aria-hidden="true" class="header-anchor">#</a> Oraclize</h4><h4 id="chainlink"><a href="#chainlink" aria-hidden="true" class="header-anchor">#</a> Chainlink</h4><h3 id="vorgeschlagene-losung"><a href="#vorgeschlagene-losung" aria-hidden="true" class="header-anchor">#</a> Vorgeschlagene Lösung</h3><h4 id="anforderungen"><a href="#anforderungen" aria-hidden="true" class="header-anchor">#</a> Anforderungen</h4><h4 id="architektur"><a href="#architektur" aria-hidden="true" class="header-anchor">#</a> Architektur</h4><h4 id="oracle-definition-language-odl"><a href="#oracle-definition-language-odl" aria-hidden="true" class="header-anchor">#</a> Oracle Definition Language (ODL)</h4><h2 id="referenzen"><a href="#referenzen" aria-hidden="true" class="header-anchor">#</a> Referenzen</h2><p><a name="ref_kim18">[KIM18]</a>: Henry M., Kim Marek Laskowski: Toward an ontology‐driven blockchain design for supply‐chain provenance.</p><p><a name="ref_reyn18">[REYN18]</a>: Ana Reyna, Cristian Martín, Jaime Chen, Enrique Soler, Manuel Díaz: On blockchain and its integration with IoT. Challenges and opportunities.</p><p><a name="ref_stru18">[STRU18]</a>: Strugar,  D., Hussain, R., Mazzara, M., Rivera, V.: M2M billing for electric autonomous vehicles.</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/book/dezentralisierung/" class="prev">
          Dezentralisierung
        </a></span><span class="next"><a href="/book/continuous-software-engineering/">
          Continuous Software Engineering
        </a> →
      </span></p></div></div></div></div>
    <script src="/book/assets/js/3.c76dc4bd.js" defer></script><script src="/book/assets/js/app.1347648d.js" defer></script>
  </body>
</html>
